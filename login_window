import tkinter as tk
import tkinter.messagebox as mb

from database_file import login as db_login


class LoginWindow:
    def __init__(self):
        self.window = tk.Tk()
        self.window.title("KSUWallet - Login")
        self.window.geometry("400x220")

        main_frame = tk.Frame(self.window)
        main_frame.pack(pady=30)

        # --------- ID ----------
        tk.Label(main_frame, text="User ID:").grid(row=0, column=0, sticky="e", padx=5, pady=5)
        self.id_entry = tk.Entry(main_frame, width=25)
        self.id_entry.grid(row=0, column=1, pady=5)

        # --------- Password ----------
        tk.Label(main_frame, text="Password:").grid(row=1, column=0, sticky="e", padx=5, pady=5)
        self.pw_entry = tk.Entry(main_frame, width=25, show="*")
        self.pw_entry.grid(row=1, column=1, pady=5)

        # --------- Buttons ----------
        btn_frame = tk.Frame(self.window)
        btn_frame.pack(pady=10)

        self.login_btn = tk.Button(btn_frame, text="Login", width=12, command=self.handle_login)
        self.signup_btn = tk.Button(btn_frame, text="Sign Up", width=12, command=self.open_signup)

        self.login_btn.grid(row=0, column=0, padx=10)
        self.signup_btn.grid(row=0, column=1, padx=10)

        self.window.mainloop()

    def handle_login(self):
        user_id = self.id_entry.get().strip()
        password = self.pw_entry.get().strip()

        #checking

        if user_id == "":
            mb.showerror("Error", "User ID cannot be empty.")
            return

        if password == "":
            mb.showerror("Error", "Password cannot be empty.")
            return

        role = db_login(user_id, password)

        if role is None:
            mb.showerror("Error", "Invalid ID or password.")
            return

        if role == "student":
            mb.showinfo("Success", "Login successful as STUDENT.")
            
        elif role == "admin":
            mb.showinfo("Success", "Login successful as ADMIN.")
      
        else:
            mb.showwarning("Warning", f"Unknown role: {role}")

    def open_signup(self):
        
        self.window.destroy()
        from signup_window import SignUpWindow
        SignUpWindow()


if __name__ == "__main__":
    LoginWindow()
